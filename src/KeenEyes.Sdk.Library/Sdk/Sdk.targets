<Project>
  <!--
    KeenEyes Library SDK - Targets

    Libraries get Core (or Abstractions) and Generators.
    Includes packaging metadata for NuGet distribution.
  -->

  <!-- Import the base .NET SDK targets -->
  <Import Project="Sdk.targets" Sdk="Microsoft.NET.Sdk" />

  <!--
    Automatic Package References for Libraries

    Libraries typically need Core for component/system development.
    Set IncludeKeenEyesCore=false for abstraction-only libraries.
  -->
  <PropertyGroup>
    <IncludeKeenEyesCore Condition="'$(IncludeKeenEyesCore)' == ''">true</IncludeKeenEyesCore>
    <IncludeKeenEyesGenerators Condition="'$(IncludeKeenEyesGenerators)' == ''">true</IncludeKeenEyesGenerators>
  </PropertyGroup>

  <ItemGroup Condition="'$(IncludeKeenEyesCore)' == 'true'">
    <PackageReference Include="KeenEyes.Core" Version="$(KeenEyesCoreVersion)" />
  </ItemGroup>

  <ItemGroup Condition="'$(IncludeKeenEyesGenerators)' == 'true'">
    <PackageReference Include="KeenEyes.Generators"
                      Version="$(KeenEyesCoreVersion)"
                      OutputItemType="Analyzer"
                      ReferenceOutputAssembly="false"
                      PrivateAssets="all" />
  </ItemGroup>

  <!-- Package Metadata Defaults -->
  <PropertyGroup>
    <PackageTags Condition="'$(PackageTags)' == ''">ecs;keeneyes;gamedev</PackageTags>
  </PropertyGroup>

  <!-- Version Compatibility Check Target -->
  <Target Name="KeenEyesVersionCheck" BeforeTargets="BeforeBuild">
    <PropertyGroup>
      <_KeenEyesVersionInfoFile>$(IntermediateOutputPath)keeneyes.version.json</_KeenEyesVersionInfoFile>
    </PropertyGroup>

    <WriteLinesToFile
      File="$(_KeenEyesVersionInfoFile)"
      Lines='{&#xD;&#xA;  "sdkVersion": "$(KeenEyesSdkVersion)",&#xD;&#xA;  "coreVersion": "$(KeenEyesCoreVersion)",&#xD;&#xA;  "minimumCoreVersion": "$(KeenEyesMinimumCoreVersion)",&#xD;&#xA;  "projectType": "$(KeenEyesProjectType)",&#xD;&#xA;  "features": "$(KeenEyesFeatures)",&#xD;&#xA;  "targetFramework": "$(TargetFramework)"&#xD;&#xA;}'
      Overwrite="true"
      Condition="'$(IsKeenEyesProject)' == 'true'" />
  </Target>

  <!-- Library Project Info Target -->
  <Target Name="GenerateKeenEyesProjectInfo"
          AfterTargets="Build"
          Condition="'$(IsKeenEyesProject)' == 'true'">
    <PropertyGroup>
      <_KeenEyesProjectInfoFile>$(OutputPath)keeneyes.project.json</_KeenEyesProjectInfoFile>
    </PropertyGroup>

    <WriteLinesToFile
      File="$(_KeenEyesProjectInfoFile)"
      Lines='{&#xD;&#xA;  "projectName": "$(MSBuildProjectName)",&#xD;&#xA;  "projectType": "$(KeenEyesProjectType)",&#xD;&#xA;  "sdkVersion": "$(KeenEyesSdkVersion)",&#xD;&#xA;  "coreVersion": "$(KeenEyesCoreVersion)",&#xD;&#xA;  "targetFramework": "$(TargetFramework)",&#xD;&#xA;  "outputType": "$(OutputType)",&#xD;&#xA;  "isAotCompatible": $(IsAotCompatible),&#xD;&#xA;  "isPackable": $(IsPackable)&#xD;&#xA;}'
      Overwrite="true" />
  </Target>

  <!-- Clean Target Extension -->
  <Target Name="CleanKeenEyesFiles" AfterTargets="Clean">
    <Delete Files="$(IntermediateOutputPath)keeneyes.version.json" ContinueOnError="true" />
    <Delete Files="$(OutputPath)keeneyes.project.json" ContinueOnError="true" />
  </Target>

</Project>
