#!/usr/bin/env bash
# Pre-commit hook: Validates code formatting before allowing commit
# Install: git config core.hooksPath .githooks

set -e

# Skip on Claude Code web sessions to avoid timeout issues
# CI/CD will run the same validations after push
if [[ "$CLAUDE_CODE_REMOTE" == "true" ]]; then
    echo "Skipping pre-commit hook (web session - CI will validate)"
    exit 0
fi

echo "Running pre-commit validations..."

# Check if dotnet is available
if ! command -v dotnet &> /dev/null; then
    echo "Error: dotnet CLI not found. Please install .NET SDK."
    exit 1
fi

# Run format check
echo "Checking code formatting..."
if ! dotnet format --verify-no-changes --verbosity minimal; then
    echo ""
    echo "Commit rejected: Code formatting issues detected."
    echo ""
    echo "To fix formatting, run:"
    echo "  dotnet format"
    echo ""
    echo "Then stage the changes and commit again."
    exit 1
fi

echo "Pre-commit validations passed."
